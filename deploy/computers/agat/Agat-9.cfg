system {
	type = agat
	name = Агат
	version = Агат-9 (в разработке)
	charmap = koi8
	debug = 1
}

cpu : 6502 {
	clock = 1021000
	stopped = 0
}

bios : rom {
	size = 2k
	image = A9-monitor.rom
}

font : rom {
	size = 2k
	image = A9-fnt.rom
}

ram : ram {
	size = 128k
}

port-kbd : port-address {
	~reset = port-kbd-reset.access
}

port-kbd-reset : port-address {}

port-kbd-ruslat : port-address {
	default = $80
}

port-C05x: port-address {}

port-C08x: port-address {
	default = 1
}

port-C1xx: ram-address {
	size = 16
	address_shift = 4
	address_mask = $F
	value_shift = 0
	value_mask = $F
}

port-C7xx: port-address {}

pm: port-address {
	soft_reset = 0
	default = 0
	setmask = 1
}

pa: register {
	soft_reset = 0
	default = 1
	~in = !pm.value
	~c = port-C7xx.access
	~r = port-C05x.access
}

display : agat-9-display {
	ram = ram
	font = font
	pa = pa
	mode_agat = port-C7xx
	mode_apple = port-C05x
	soft_reset = 0
	~ints_en = !port-int-en.value[6]
}

keyboard : map-keyboard {
	map = agat.map
	port-value = port-kbd
	ruslat = caps
	port-ruslat = port-kbd-ruslat
	rus-on = 0
	rus-bit = 7
}

port-int-en : port-address {
	default = $FF
	soft_reset = 0
}

port-sound : port-address {}

sound : speaker {
	mode = flip
	~input = port-sound.access
}

mapper : memory-mapper {
	portstomemory = 1

	@memory[$0000-$BFFF] = ram
	@memory[$F800-$FFFF] = bios {mode = r}

	@memory[$C000-$C00F] = port-kbd
	@memory[$C010-$C01F] = port-kbd-reset
	@memory[$C020-$C02F] = port-int-en[$20]
	@memory[$C030-$C03F] = port-sound
	@memory[$C040-$C04F] = port-int-en[$40]
	@memory[$C050-$C057] = port-C05x
	@memory[$C063-$C063] = port-kbd-ruslat
	@memory[$C080-$C08F] = port-C08x
	@memory[$C0F0-$C0FF] = pm {mode = w}

	@memory[$C100-$C1FF] = port-C1xx
	@memory[$C700-$C7FF] = port-C7xx

}



